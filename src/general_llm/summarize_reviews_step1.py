# summarize reviews

# context = '''Достоинства: В целом всё хорошо, шустрый, удобный, юзал 9t почти 5 лет, и знал, что марку китай держит, надеюсь хуже не станет. новый телефон это всегда топ но, пол годика надо походить конечно же (на руках неделю только). Камера любая огонь, функций через край, при желании можно очень сочно и красиво (лейка режим великолепен) снять, даже в авто режиме и при селфи видео звонках против солнца справляется на ура. тяжелых игр особо не любитель, может как-нибудь порт сан-андреас замучу конечно) на данный момент установлены wreckfest и carxsteet и всё хорошо. Троттлинг если есть, то я до него не доиграл. играет на фул и ок. Недостатки: Тут индивидуально. Прям минусов дейсвительно нет, кроме как уронить 80к на пол). Вот действильно некорректный и не ясный момент (и да я видел в обзорах и готов с этим смирился) при зуме фото/видео переключение камеры с основной на следующую 2х проиходит резко, что по цветности, что по объему, так сказать, особенно заметно будет с очень дальними объектами, если на фоне стоят ближние. Но у сяоми это уже врожденное, надеюсь с прошивками что-то и исправится, обещают к концу года пощную обнову к ОС. Но не смотря на любовь к фото/видео, не часто эта функция на ходу и понадобится по факту. Если не забуду что и дополню по мере необходимости. Комментарий: Не ну ты хочешь топ и фул последней модели? Бери и кайфани) Либо ждать год до понижения цен, а там по кругу - новая модель и ожидание. Меняю телефоны редко, хотя могу позволить себе последний айфон на каждую зп, но смыла частой смены не вижу, хожу и юзаю до потери пульса. А прошлый сяоми буду юзать как 2й, норм все с ним.
#
# Достоинства: пушка, все летает, экран прекрасный, чехол в комплекте софт тач, очень удобный. удобный форм фактор- будто снова на Айфоне , больше нравится, чем мой прежний размер 12Т про. да и выглядит просто солидно. Недостатки: первые дни как будто запотевала карта при съёмке, выяснил, что остаточная влага, а так как защита от влаги ip68, то что то не вышло . решилось прогревом через бенчмарки и играми, прошло
#
# Достоинства: весь он Недостатки: цена Комментарий: прекрасная камера, шикарный экран, быстрая зарядка и весь комплект фишек присущих для топового смартфона.
# очень даже небольшой и хорошо лежит в руке, особенно женской.
# минус один. цена.
# если покупать глобал версию на 512 Гб где то за 70-75 прекрасно.
# дороже конечно наверно не факт что он этого стоит
#
# Достоинства: Телефон просто космос Недостатки: Их просто нет Комментарий: Телефон из области китайских нанотехнологий. Никакие там айфоны и гнусмасы даже рядом не стояли, он из просто кладет на лопатки. Быстродействие, память, бомбические снимки .. перечислять можно бесконечно. Кто сейчас носит в кармане американский кирпич, настоятельно рекомендую к покупке именно данный аппарат.
#
# Достоинства: Очень приятный аппарат, шустро работает, всё летает, анимации плавные.
# Камера шик :)
# Аккумулятор смело держит до ночи.
# Сканер отпечатка пальца выше всяких похвал: работает мгновенно даже на пролетающий мимо палец. Недостатки: Не придумаю даже. Крутой телефон) Комментарий: Это действительно глобальная версия.
# Лишних приложений практически нет, не к чему придраться. Русский язык, на коробке английские буквы и наклейка "опечатано". Супер.
#
# P.S. на HyperOS не ведитесь: выглядит точно так же как MIUI, только вылизанный :)
#
# Достоинства: быстрый, хорошая камера, красивый ) Недостатки: пока не обнаружено Комментарий: вижу, что у людей много вопросов о глобальной версии, действительно-это глобалка) русский язык естественно есть, в наборе чехол, зарядник и инструкция, всё работает быстро и чётко, без нареканий, заряд держит хорошо, заряжаю один раз в день при том, что телефон из рук не выпускаю) в общем если вы как и я ждали долго этот телефон, смело берите)
#
# Достоинства: отличные характеристики, отличная камера, хороший внешний вид Недостатки: цена на нашем рынке) Комментарий: продавец задержал посылку на недельку, но это не так страшно, так как аппарат не просто глобалка, а официальная поставка для российского рынка, с оф. гарантией.
#
# Достоинства: лёгкий, компактный, дизайн топчик) зарядка быстрая Недостатки: нету
#
# Достоинства: приятный, мощный, шустрый Недостатки: чем то похож на айфон, для кого то это плюс, но я всё же люблю Андроиды за их свободу и индивидуальность Комментарий: хороший телефон, я доволен, материалы качественные, работает как швейцарские часы
#
# Достоинства: все отлично работает аппарат супер продавец топ Недостатки: пока не обнаружил'''


# raw_template = f'''<s> [INST] Ты суммаризатор достоинств и недостатков товаров. На основе контекста ниже сделай список плюс и минусов товара. [/INST]
# Контекст: {context}
# Ответ: </s>
# '''

# raw_template = f'''Ты суммаризатор достоинств и недостатков товаров. На основе контекста ниже сделай JSON из достоинств и недостатков товара. В ответе используй ТОЛЬКО русский язык.
# Контекст: {context}
# JSON:
# '''

context = '''Достоинства: 1. Хорошая вместимость в сочетании с габаритами. 7,5 кг на одной стирке - это более чем полный комплект двуспального постельного белья, хороший результат.2. Большой набор программ, очень многие из которых можно сильно ускорить, причём есть две степени ускорения.3. Для тех, кто спешит, есть экспресс на 30 минут, который можно ускорить до 14 минут.4. Приятный внешний вид. Стильная и мягкая основная крутилка, белые цифры и символы на экране.5. Загрузочный люк спереди закрыт декоративной накладкой из тёмного почти непрозрачного пластика. Это хорошо тем, что позволяет избежать контакта с горячим стеклом люка в случае стирок на высоких температурах.6. Ножки имеют наконечники из мягкой, цепкой резины и за счёт этого очень сопротивляются скольжению. Регулировка осуществляется удобно, контр-гайка подкручивается удобно.7. При правильной установке имеет низкую вибрацию и стоит устойчиво. Для правильной установки мало просто выставить по уровню, надо убедиться, что она плотно стоит сразу на 4 ножках, без ослабления одной из ножек. Для этого машинку надо сверху попытаться покачать по диагоналям, даже маленький люфт-качание (как у табуретки с одной из ножек чуть короче других) недопустим - она должна стоять плотно, как хорошо нагруженный шкаф на ровном полу.8. Более тихий двигатель, чем у машин без инверторного привода. Недостатки: 1. Кнопки управления сделаны не физическими, а тач-кнопками. Настройка функций откровенно замедляется.2. Выбор и указание программы осуществляется засечкой на основной крутилке управления, что заставляет наклоняться перед машинкой при выборе программы. Формат "крутилка + лампочки напротив выбранной программы", как это реализовано, например, в имеющейся у меня Gorenje WA 943 S, намного удобнее.3. Машинка умеренно тихая, но не самая тихая, как это можно было бы ожидать от инверторного двигателя. Скажем так, машинка промежуточная по своей шумности, дорогим моделям она в этом плане не конкурент, но бюджетные варианты без инвертора однозначно превосходит. Комментарий: По соотношению цена-качество машинка заслуживает оценки 5 и рекомендуется к покупке.Беспроводные подключения не пробовал.Упаковка у всей крупной техники Беко представляет собой:1. пенопластовые дно и крышу с пенопластовыми боковыми вставками по углам.2. потом всё обтягивается плотной термоусадочной полиэтиленовой плёнкой.Коробок у Беко нет с завода.В некоторых случаях в стиральной машине может остаться немного воды после её проверки на заводе.

Достоинства: Тихая,качественная, функциональная Недостатки: Их объективно два 1) Это лоток для загрузки порошка, он не плохой, но мог бы быть лучше 2) Колесо выбора режимов, хотелось бы его улучшить в плане тактильных ощущений и надежности Комментарий: У меня было всего четыре стиральные машины за всю жизнь, три Бош и одна Канди. С Канди сравнивать не буду, тут Беко точно лучше.Начнем с плюсов по сравнению с Бошем1) Инверторный мотор, он значительно тише и плавнее работает2) Опять же тишина в режиме стирки и отжима3)Ножки и их регулировки, они встают как вкопанные, на боше постоянно машинка катается4)Есть возможность подключения к телефону с выбором программ стиркиТеперь минусы1) Лоток для порошка, ну хлипковат он и двигается не так плавно как хотелось бы2) Колесо выбора режимов стирки, не такое удобное и качественное как на Бош3) Дверца лючка на боше может выдержать ядерный взрыв, я даже ковер запихивал в нее, и дверца держала. Здесь не выдержит точно, но для аккуратного использования пойдетЯ очень надеюсь, что машинка не подведет и проработает хотя бы лет пять.p.s Боши до нее всё ещё работают у других владельцев, 17лет, 11лет, 9лет, последний работал в режиме каторжника, так как обслуживал четырех детей и двух взрослых, 24/7 по 1-3 раза в день. Но цены сейчас на Бош просто невменяемые

Достоинства: хорошо стирает вещи, много режимов, есть управление по блютуз,но я его ещё не пробовала.Красивый дизайн на стильная машинка.Вместительная и есть звук при отключении стирки. Недостатки: Вообще нет, только один раз при 5 стирки был какой то грохот внутри сильный, стирка продолжилась,а когда я достала белье был очень сильный и неприятный запах какого-то то ли масла что ли, белье всё пропахло, поставили на повторный режим стирки только уже на быструю и всё стало отлично стирать и больше этого запаха не было. В использовании всего была 10стирок, больше недостатков нет.Шумит при стирке не громко , немного как будто подвывает у-у-у.Стоит в ванной и если дверь закрыта,то вообще ничего не слышно,как она работает. Комментарий: Я довольна покупкой этой машинки! Стирает хорошо, отжим отличный, я в основном больше 1000об не делаю.Но если на 600то вещи мокрые конечно.Надеюсь на её долгую службу, прошлая машинка была Самсунг диамант,проработала 10лет .

Достоинства: Тихая.. Вместительная. Возможность корректировать программы на свой вкус (температуру, скорость отжима, замачивание, а в приложении так же к хлопку можно воды добавить и включить до 5 полосканий) по сравнению с другими марками со стандартными програмами. Сокращение времени стирки. Недостатки: Нет. Даже неразборный бак на фоне цены и функционала не кажется такой трагедией, но пластиковая петля люка - изгибается под тяжестью люка. Пришлось купить отдельно металлическую петлю. ( еë код 2850610100) Теперь хоть крышка люка не провисает. Комментарий: Подшипник 203 наружный, следовательно 204 внутренний, так что не перегружайте машинку. Я взял на 7,5 кг для стирки 5-6 кг бельяСтавьте на замок всегда, так вы не сбросите свою программу от случайных прикосновений к сенсору. Поверьте - прикоснëтесь не раз. Кот при спрыгивании у меня умудряется задеть сенсор.В приложении есть программа "Смешанная"P. S. странные ножки, они у меня к линолеуму прилипли.

Достоинства: Тихая, нет шума, удобно, интуитивно понятная, качество. Недостатки: Пока нет. Комментарий: До этой машинке, пользвались тоже Beko (узкой, вместимостью 5кг, купленой 10 лет назад, но тот момент Full). Выбирали между опять Beko и Candy (одна и та-же фирма их делает, Arcelik, Турция. Сборка Россия). В итоге остановились на этой модели, так как по цвету подходит к ванной комнате, старая тоже была серой. Многих по отзывам не понимаю, пишут что пластик слабый, стекло на барабане пачкается (если что, тёмное стекло снимается) и вам будет вид обычного барабана. Так же многие пишут про лоток для стиральных средств, якобы хлипкий. Был небольшой зазор в нижнем левом углу, и какибы випирал лоток от корпуса. Но это деталь. Я лично лоток снял, и этот угол который выпирал на 2мм, прижав его к основе замазал эбокситным клеем, прямо пару капель. Зажав и держа в руке 5 мин, установил обратно и оставил лоток на сутки без дёргания. В итоге всё ровно. Но самое крутое в этом аппарате, инверторный мотор, это нечто. Кто сомневается, тот ошибается. Покупайте смело эту машинку, она того стоит. По приложению для работы с телефона совет.. не торопитесь при нажатии кнопок (дальше, вперёд и т.д.), немного ждите. Приложение Турецкое и сервер тоже там, так что немного терпения и всё конектится в итоге. Телефоны с root правами в пролёте, приложение слетает, даже не открывается. Как-то так. Всем удачных покупок!

Достоинства: Функционал, тихая, вместительная. Недостатки: Получили, когда на улице была температура под - 30 градусов. По правилам, в инструкции, воду надо сливать перед транспортировкой. К нашему ужасу, когда смогли открутить слив - увидели, что там лёд. Тобишь внутри была вода и всё замерзло. Ждали больше суток. Включили и выдохнули: работает, не течёт, пронесло короче. Комментарий: Функция пар - пробовала, не знаю, может что-то и меняется. Функция шерсть- шерсть всё одно осталась. Ролик для одежды в помощь. В прошлой Элджи - когда стирала чёрное или летом на быструю - добавляла доп полоскание - тут доп полоскание не добавить(( Всё устраивает. По цене тоже хорошо получилось.

Достоинства: Стильная, многофункциональная, не шумная. Недостатки: К прадовцу претензий нет. Товар отличный. Проблема с доставкой. Не смогла взять телефон из за рабочего момента, перезвонила курьеру через 10 минут, на что он мне ответил, что он отменил доставку и уехал. И это уже не первый раз такое, то они перенесли то отменили. Ни в одном маркете такого нет, как у Яндекс. Комментарий: По началу я конечно расстроилась и хотела сделать возврат, так как при отжиме она очень сильно скрипела. Но потом оказалось, что причина не в неисправности машинки, а в нас самих🤣🤣🤣. По мимо транспортировочных болтов, там еще оказывается есть фиксирующий пенопласт между барабаном, его нужно было вытащить из под низу, а мы его не заметили и по этому стоял скрип. Машинка 🔥🔥🔥🔥, особенно функция удаление шерсти домашних животных. Справляется с удалением шерсти не хуже чем сушильная машина. На постельном и черных вещах, шерсть не остаётся от слова совсем. Товар к покупке рекомендую.

Достоинства: Очень нравится, 7.5 кг, то что надо на семью из 3 человек плюс кошак Недостатки: Ттт их нет Комментарий: Машинка была привезён курьерами в срок, была без картонной коробки я думала все конец надо делать возврат но муж сказал что такое бывает когда распаковали она была в заводском поэлитилене где специально вырезано окошко для люка, в общем машинка огонь пробовали стирать на программе очистка от шерсти животных не верила в эту функцию но видимо что то происходит и при окончании стирки шерсть на резинке люка собирается. Конечно плед был не на сто процентов очищен но все таки это очень хорошо так как весной осенью кошак лезет как старый веник! Очень классно что можно выбирать быстрая стирка на многих режимах! Стирает хорошо, выполаскивает тоже если конечно не сыпать много порошка, нельзя перебарщивать я один раз переборщила потому что раньше была на 5 кг машинка там меньше лоток для порошка. То что разница между бывшей 5 кг и 7.5 кг это колоссальная разница очень удобно для семьи. Единственный момент я постирала на самой быстрой стирке и хотела проверить отстиралось или нет, открыла посмотрела, норм, и включаю отжим и полоскание а она щёлкает три раза и не работает в общем если есть представители Beko то ответьте мне пожалуйста почему так. Может бельё мокрое перевес идёт и она не соображает что надо отжать? В общем надо почитать инструкцию. Управление интуитивное, лёгкое, Функцию пара хочу ещё оценить... Чтобы поставить замачивание или пар надо удерживать кнопку 3 секунды. Стирает и отжимает тихо, в общем мы рады я особенно :-)

Достоинства: тихая,стильная,вместительная Недостатки: мой телефон не видит ее Комментарий: я приятно удивлена покупкой. машинка очень вместительная, слегкостю постирала мой длинный зимний пуховик. как не странно тихая, я ставлю ее стираться ночью и за закрытой дверью ее не слышно. программы длинные, чтобы уменьшить время, после того как выберите программу, нажмите кнопку быстрая стирка и сократите время. пенопласт под стиральной машинкой, есть даже наклейка предупреждающая об этом. машинку скорее всего проверяли перед отправкой, в шланге и в отсеке для порошка была вода. я довольна, за такую цену достойная стиральная машинка.

Достоинства: Отличная стиральная машина. Есть все режимы, которые мне требуются. Радует что есть таймер, сколько осталось до конца стирки. Со своей работой справляется как нужно. Очень тихая, по сравнению со всеми моими предыдущими стиральными машинами. Просторный барабан, помещается весь комплект постельного (а у меня большой комплект). В общем я довольна этим приобретением. Недостатки: Единственное что мне мешает, это то, что панель сенсорная, реагирует на малейшее прикосновение. Я периодически задеваю случайно кнопки из-за этого. Комментарий: За свою цену отличная стиралка. Есть всё что нужно, со всем справляется.'''

raw_template_system = '<s>[INST] You summarize consumer goods reviews in great detail. Based on the context below make a JSON of the advantages and disadvantages of the product. Generate at least five points for both advanatges and disadvantages. [/INST]</s>'
raw_template_context = f"<s> Context: {context} </s>"

mixtral_raw_template_system = '<s> [INST] <<SYS>>\n You are a world class review analyst. Summarize advantages and disadvantages from the consumer goods reviews below. The output JSON keys must only be "advantages", "disadvantages", "comments".\n <</SYS>> [/INST]'
mixtral_raw_template_context = f" [INST] Reviews: {context} [/INST]\n\n"

mistral_raw_template_system = '<s> [INST] \n You are a world class review analyst. Summarize advantages and disadvantages from the consumer goods reviews below. The output JSON keys must only be "advantages", "disadvantages", "comments".\n [/INST]'
mistral_raw_template_context = f" [INST] Reviews: {context} [/INST]\n\n"

from langchain_community.llms import LlamaCpp
from langchain_core.prompts import ChatPromptTemplate, PromptTemplate, ChatMessagePromptTemplate
from langchain_core.output_parsers import JsonOutputParser
from langchain_core.pydantic_v1 import BaseModel, Field


class ReviewSummary(BaseModel):
    advantages: list = Field(description="list of main advantages")
    disadvantages: str = Field(description="list of main disadvantages")
    comments: str = Field(description="overall conclusion")

from loguru import logger
from langchain_core.runnables import RunnableLambda, RunnablePassthrough
def def_debugger(inp):
    logger.info(inp)
    return inp

debugger = RunnablePassthrough(def_debugger)

chat_model = LlamaCpp(
    # llama 13b saiga: -- '../models/model-q4_K(2).gguf'
    # roleplay - mixtral moe 8x7b: -- mixtral-8x7b-moe-rp-story.Q4_K_M
    # model_path='/home/amstel/llm/models/mixtral-8x7b-v0.1.Q4_K_M.gguf',
    # model_path='/home/amstel/llm/models/qwen1_5-14b-chat-q4_k_m.gguf',

    # model_path='/home/amstel/llm/models/mixtral-8x7b-moe-rp-story.Q4_K_M.gguf',
    model_path = '/home/amstel/llm/models/mistral-7b-instruct-v0.2.Q5_K_M.gguf',

    n_gpu_layers=33, # 28 for llama2 13b, 10 for mixtral
    max_tokens=1000,
    n_batch=128,
    n_ctx=6044,
    f16_kv=True,  # MUST set to True, otherwise you will run into problem after a couple of calls
    verbose=False,
    temperature=0.0,
    # stop=["</s>"],
)

from langchain_core.messages import AIMessage, SystemMessage, HumanMessage
# template = ChatPromptTemplate.from_template(raw_template)


template = ChatPromptTemplate.from_messages(
    [
        SystemMessage(content=mistral_raw_template_system),
        HumanMessage(content=mistral_raw_template_context),
        AIMessage(content=' JSON: '),
    ]
)

# bullshit
# template = ChatPromptTemplate.from_messages(
#     [
#         ("system", raw_template_system),
#         ("assistant", "JSON:"),
#     ]
# )

# https://github.com/QwenLM/Qwen1.5/blob/main/docs/source/training/SFT/example.rst
# template = ChatMessagePromptTemplate.from_template(
#     messages=[
#         {'role': 'system', 'content': raw_template_system},
#         {'role': 'assistant', 'content': 'JSON: '},
#     ]
# )

parser = JsonOutputParser(pydantic_object=ReviewSummary)
chain = (template |
         # debugger |
         chat_model |
         parser)

print(chain.invoke(input={}))

output = {
    "pros": [
        "очень хороший дизайн",
        "очень быстрый"    "очень хорошая камера",
        "очень хорошая акустика",
        "очень хорошая зарядка",
        "очень хорошая автономность"
    ],
    "cons": [
        "цена"
    ]
}
{'достоинства': ['отличный дизайн', 'широкий экран', 'быстрая зарядка', 'удобная камера'], 'недостатки': [], 'комментарий': 'Телефон на высшем уровне, рекомендую всем.'}

# {'pros': ['Excellent performance', 'High-quality materials', 'Swiss-like precision and reliability', 'Good camera quality', 'Fast charging', 'Attractive design'],
# 'cons': [], 'comment': 'A top-notch phone from a reputable seller. Customers are generally satisfied with the device.'}
